var fileType={"folder":"fa fa-folder","file":"fa fa-file-text","doc":"fa fa-file-word-o","docx":"fa fa-file-word-o","jpg":"fa fa-picture-o"};
function appendFileBox($container,jsonData){
	 var icon=fileType['file'];
	 if(jsonData.type=='folder'){
		 icon=fileType['folder'];
	 }else{
		 var tmp=fileType[jsonData.suffix];
		 if(tmp)icon=tmp;
	 }
	 var content="<div class=\"icon\"><i class=\""+icon+"\"></i></div><div class=\"file-name\">"+jsonData.name+"<br/><small>修改时间："+jsonData.lastModified+"</small></div>";
	 var $fileBox=$("<div class=\"file-box animated fadeInRight\"><div class=\"file\"><a href=\"javascript:;\" data-path=\""+jsonData.path+"\" data-file-type=\""+jsonData.type+"\"><span class=\"corner\"></span>"+content+"</a></div></div>");
	 $container.append($fileBox);
	 $fileBox.find(".file a").data("target",jsonData);
	 $fileBox.find(".file a").on("click",openFolder);
}

var openFolder=function(){
	var path=$(this).data("path");
	var fileType=$(this).data("file-type");
	if(fileType=="folder"){
		$.ajax({
			 url: basePath+'/admin/resources/list',
			 method:"post",
	        data: {path: path},
	        dataType: 'json',
	        traditional:true,
	        success: function (data) {
		       	 $(".file-container").empty();
		       	 for(var i in data){
		       		 appendFileBox($(".file-container"),data[i]);
		       	}
		       	$(".file-box").each(function(){
		    		animationHover(this,"pulse");
		    	});
	        }
		 });
	}else{
		var target=$(this).data("target");
		parent.layer.open({
			    type: 2,
	            title: '编辑文件:'+target.name,
	            shadeClose: true,
	            shade:false,
	            maxmin: true, //开启最大化最小化按钮
	            area: ['80%', '80%'],
	            content: [basePath+'/admin/resources/edit?path='+target.encodePath], //iframe的url，no代表不显示滚动条
			    end: function(){ //此处用于演示
			    	
			    }
			});
	}
	 
};
$(document).ready(function(){
	$(".folder-list a").on("click",openFolder);
});

